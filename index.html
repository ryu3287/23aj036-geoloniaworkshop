<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Geolonia Maps Workshop</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.geolonia.com/v1/embed?geolonia-api-key=abf99257c8a3424eb286027b5031e328" defer></script>
</head>

<body>
  <h1>Geolonia Maps – Marker Workshop</h1>

  <div
    class="geolonia"
    data-lat= "34.342"
    data-lng= "134.046"
    data-zoom="13"
    data-marker="on"
    style="width:100%; height:60vh;"
  ><div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const el = document.querySelector('.geolonia');

      el.addEventListener('geolonia.load', async (e) => {
        const map = e.detail.map;

        // data.geojson ファイルを読み込む
        const res = await fetch('./data.geojson');
        const geojson = await res.json();

        // 各データ（feature）に対してマーカーを置く
        for (const f of geojson.features) {
          const [lng, lat] = f.geometry.coordinates;
          const { name, desc } = f.properties;

          new maplibregl.Marker()
          .setLngLat([lng, lat])
          .setPopup(new maplibregl.Popup()
          .setHTML(`<strong>${name}</strong><br>${desc ?? ''}`))
          .addTo(map);
        }

        // すべてのマーカーが画面に収まるように表示範囲を調整
        const coords = geojson.features.map(f => f.geometry.coordinates);
        const bounds = coords.reduce((b, c) => b.extend(c), new maplibregl.LngLatBounds(coords[0], coords[0]));
        map.fitBounds(bounds, { padding: 40, duration: 500 });
      });
    });
  </script>
</body>


</html>
